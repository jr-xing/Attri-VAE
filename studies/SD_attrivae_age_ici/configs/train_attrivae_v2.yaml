# AttriVAE Training Configuration for Age/ICI Study - V2
#
# CHANGES from v1:
# - Using MEAN reduction for reconstruction loss (not SUM)
# - Added KL/AR warmup over first 50 epochs
# - Rebalanced loss weights for proper reconstruction
#
# The key issue in v1: reconstruction loss used SUM reduction giving ~6000-23000
# while KL was ~300, so model prioritized KL over reconstruction.
#
# Strategy in v2:
# 1. Use MEAN reduction for reconstruction (gives ~0.01-0.1 range)
# 2. Warmup KL and AR weights over 50 epochs
# 3. Higher recon_param to prioritize reconstruction quality

# Data configuration
data:
  data_file: "/gpfs/gibbs/project/kwan/jx332/code/2025-09-LGE-CHIP-Classification-V2/data/2025-06-01-onc-cohort-144-with-serial-scans-and-103-LGE-masks.npy"
  spreadsheet: "/gpfs/gibbs/project/kwan/jx332/code/2025-09-LGE-CHIP-Classification-V2/link_project_data/CHIP ICI MI CM outcomes - Updated 2025-10-09.xlsx"
  val_fraction: 0.2
  seed: 42

# Model architecture
model:
  image_channels: 1
  h_dim: 96
  latent_size: 64
  n_filters_enc: [8, 16, 32, 64, 2]
  n_filters_dec: [64, 32, 16, 8, 4, 2]
  target_size: [80, 80, 80]

# Training parameters
training:
  batch_size: 8
  epochs: 500
  learning_rate: 0.001    # Higher LR for faster convergence
  num_workers: 4
  augment: true

# Loss weights - REBALANCED for MEAN reduction
# With MEAN reduction, recon loss will be ~0.01-0.1
# KL loss is ~0.1-1.0 per dim, AR loss is ~0.1-1.0
loss:
  recon_param: 1000.0     # High weight to prioritize reconstruction (1000 * 0.01 = 10)
  beta: 0.1               # Moderate KL weight (will be warmed up)
  alpha: 1.0              # MLP classification weight
  gamma: 1.0              # AR weight (will be warmed up)
  factor: 100.0           # tanh scaling factor in AR loss

# Warmup settings
kl_warmup_epochs: 50      # Gradually increase KL and AR weights over 50 epochs

# Training flags
use_AR_LOSS: true         # Enable attribute regularization
is_L1: false              # Disable L1 weight regularization

# Output
output_dir: "/gpfs/gibbs/project/kwan/jx332/code/2025-12-Attri-VAE/studies/SD_attrivae_age_ici/outputs/training"
